from plugin_manager.manager import plugin_manager
from cmd2 import with_argparser
import argparse
import socket
import threading
import json
from collections import namedtuple


argparser = argparse.ArgumentParser()
argparser.add_argument('-d', help="data to send", required=True)


class test(plugin_manager):

    @with_argparser(argparser)
    def do_send(self, args):

        def json_decoder(my_dict):
            return namedtuple("X", my_dict.keys())(*my_dict.values())

        class Comm:
            command = None

        temp = Comm()
        temp.command = args.d

        self.connections[int(self.current_session)].send(json.dumps(temp.__dict__).encode())
        data = self.connections[int(self.current_session)].recv(1024)
        my_json = json.loads(data.decode(), object_hook=json_decoder)
        print(my_json.output)
        
