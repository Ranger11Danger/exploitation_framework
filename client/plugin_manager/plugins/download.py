from plugin_manager.manager import plugin_manager
from cmd2 import with_argparser
import argparse
from libs.comm import send_msg, my_proto
import json

argparser = argparse.ArgumentParser()
argparser.add_argument('-r', help="file to download", required=True)
argparser.add_argument('-f', help="local file location", required=False)

class test(plugin_manager):
    @with_argparser(argparser)
    def do_download(self,args):
        
    

        if args.f:
            proto = my_proto(message_type="download", data="", channel="1", filename=args.r)
            data = send_msg(self.connections[int(self.current_session)], proto)

            with open(args.f,"w") as file:
                file.write(data.data)
            print("File Downloaded!")
        else:
            proto = my_proto(message_type="download", data="", channel="1", filename=args.r)
            data = send_msg(self.connections[int(self.current_session)], proto)
            
            with open(data.filename.split("/")[-1],"w") as file:
                file.write(data.data)
            print("File Downloaded!")