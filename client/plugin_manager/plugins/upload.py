from plugin_manager.manager import plugin_manager
from cmd2 import with_argparser
import argparse
from libs.comm import send_msg, my_proto
import json

argparser = argparse.ArgumentParser()
argparser.add_argument('-f', help="file to upload", required=True)
argparser.add_argument('-r', help="remote location", required= False )

class test(plugin_manager):
    @with_argparser(argparser)
    def do_upload(self,args):
        with open(args.f, 'r') as my_file:
            data = my_file.read()
            if not args.r:
                file = args.f.split('/')[-1]
                proto = my_proto(message_type="upload", data=data, channel="1", filename=file)
            else:
                proto = my_proto(message_type="upload", data=data, channel="1", filename=args.r)

        data = send_msg(self.connections[int(self.current_session)], proto)

        print(data.data)